{% extends "projects/base.html" %}
{% load static %}
{% load cache %}

{% block seo_title %}
Graphic Designs | Visual Identity & Creative Design Portfolio
{% endblock %}

{% block seo_description %}
Explore a curated collection of graphic designs focused on branding,
visual identity, print design, and creative digital solutions.
{% endblock %}

{% block title %}Graphic Designs{% endblock %}
{% block body_class %}designs-page{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/designs.css' %}">
{% endblock %}

{% block content %}
<section class="portfolio-section">
  <div class="portfolio-container">

    <!-- Header (Fragment Cache) -->
    {% cache 86400 designs_header %}
    <header class="portfolio-header">
      <h1>Graphic Designs</h1>
      <p>My Creative Work & Visual Identity</p>
    </header>
    {% endcache %}


    <!-- Categories -->
    <nav class="categories">
      <a href="{% url 'designs:list' %}" class="{% if not active_slug %}active{% endif %}">All</a>
      {% for c in categories %}
        <a href="?category={{ c.slug }}" class="{% if active_slug == c.slug %}active{% endif %}">
          {{ c.name }}
        </a>
      {% endfor %}
    </nav>

    <!-- Grid -->
    <div class="design-grid">
      {% for d in designs %}
      <article class="design-card">
      <a href="#" class="open-modal"
         data-img="{{ d.image.url }}"
         data-title="{{ d.title }}"
         data-desc="{{ d.description }}">

        <div class="img-wrap">
          <img src="{{ d.image.url }}" alt="{{ d.title }}">
        </div>

        <div class="overlay">
          <span>View</span>
        </div>
      </a>
      <div class="card-info">
        <h4>{{ d.title }}</h4>
        {% if d.category %}
          <small>{{ d.category.name }}</small>
        {% endif %}
      </div>
    </article>
      {% empty %}
        <p class="empty">No designs yet.</p>
      {% endfor %}
    </div>
  </div>
</section>
<!-- Lightbox -->
<div id="lightbox">
  <div class="lb-box">
    <span id="close">&times;</span>
    <img id="lb-img">
    <h3 id="lb-title"></h3>
    <p id="lb-desc"></p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ================= LIGHTBOX ================= */
  const modal = document.getElementById("lightbox");
  const lbImg = document.getElementById("lb-img");
  const lbTitle = document.getElementById("lb-title");
  const lbDesc = document.getElementById("lb-desc");
  const closeBtn = document.getElementById("close");

  document.querySelectorAll(".open-modal").forEach(card => {
    card.addEventListener("click", e => {
      e.preventDefault();
      lbImg.src = card.dataset.img;
      lbTitle.textContent = card.dataset.title || "";
      lbDesc.textContent = card.dataset.desc || "";
      modal.style.display = "flex";
    });
  });

  closeBtn.onclick = () => modal.style.display = "none";
  modal.onclick = e => {
    if (e.target === modal) modal.style.display = "none";
  };

  /* ================= AUTO SCALE (DESKTOP ONLY) ================= */
  if (window.innerWidth >= 768) {

    document.querySelectorAll(".design-card a").forEach(card => {
      const img = card.querySelector("img");
      if (!img) return;

      const applyScale = () => {
        const imgH = img.naturalHeight;
        const imgW = img.naturalWidth;
        const ratio = imgH / imgW;

        if (ratio > 1.3) {
          img.style.transform = "scale(0.88)";
        }

        if (imgH > 2500 || imgW > 2500) {
          img.style.transform = "scale(0.82)";
        }
      };

      if (img.complete) {
        applyScale();
      } else {
        img.addEventListener("load", applyScale);
      }
    });

  }

});
</script>


{% endblock %}
